/* =============================================================================
   LEGACY CSS - BEING PHASED OUT
   This file contains deprecated styles replaced by Tailwind CSS (via CDN).
   See layout.html for Tailwind config and new component implementations.
   ============================================================================= */

/* !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   ⛔ CRITICAL: NAVBAR STYLES FORBIDDEN HERE ⛔
   
   DO NOT add ANY navbar background, #main-navbar, or .navbar background styles!
   
   WHY: Navbar styles MUST live in layout.html's inline <style> block to:
   - Ensure !important precedence without cascade conflicts
   - Keep navbar UI separate from legacy CSS
   - Prevent the 7+ regressions we've had from CSS file loading order
   
   LOCATION: src/main/resources/templates/fragments/layout.html (lines 169-178)
   
   ALLOWED HERE: .navbar-brand, .navbar-toggler (non-background styling only)
   FORBIDDEN: Any #main-navbar styles, navbar background colors, navbar layout
   
   IF YOU NEED TO CHANGE NAVBAR:
   1. Edit layout.html's <style> block, NOT this file
   2. Do NOT add navbar background styles here
   3. Legacy .navbar-brand styles below are ONLY for logo, not background
   
   This guard exists because navbar background styles were repeatedly 
   overridden by CSS in this file, causing persistent visual regressions.
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */

/* =============================================================================
   CASCADE LAYER ARCHITECTURE
   Layers define specificity hierarchy without !important hacks.
   Order: reset < base < components < utilities < theme-overrides
   ============================================================================= */
@layer reset, base, components, utilities, theme-overrides;

/* Base Styles - Minimal fallbacks for legacy pages */
@layer base {
    /* Ensure HTML element also gets background color to prevent white gaps */
    html {
        background-color: var(--bg-color);
        margin: 0;
        padding: 0;
    }
    
    body {
        font-family: var(--font-family-body);
        background-color: var(--bg-color);
        color: var(--text-color-primary);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        line-height: 1.6;
        margin: 0;
        padding: 0;
    }
}

/* KEEP - Still used for fallback typography, but will be replaced incrementally */
@layer base {
    h1, h2, h3, h4, h5, h6 {
        font-family: var(--font-family-headings);
        margin-bottom: 1rem;
        font-weight: 700;
        color: var(--text-color-primary);
    }

    /* KEEP - Still used for fallback link styles */
    a {
        color: var(--link-color);
        text-decoration: none;
        transition: all 0.3s ease;
    }

    a:hover {
        color: var(--link-hover-color);
    }
}


.navbar-brand {
    font-family: var(--font-family-headings);
    font-weight: 700;
    color: var(--text-color-accent);
    font-size: 1.5rem;
    padding: 0;
    display: flex;
    align-items: center;
    position: relative;
    z-index: 1001;
    cursor: pointer;
}

.navbar-brand img {
    height: auto;
    width: auto;
    -webkit-user-drag: none;
    pointer-events: auto; /* Ensures clickability */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none; /* Cross-browser alternative to prevent selection */
    pointer-events: auto;
}

.navbar-brand,
.navbar-brand * {
    pointer-events: auto;
    -webkit-user-select: none;
    user-select: none;
}

.nav-link {
    color: var(--text-color-secondary);
    font-weight: 600;
    transition: color 0.3s;
    padding: 0.5rem 1rem;
    margin: 0 0.25rem;
    position: relative;
}

.nav-link:hover, .nav-link.active {
    color: var(--text-color-accent);
}

.nav-link.active:after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: currentColor;
    border-radius: 2px;
}

.navbar-toggler {
    border: none;
    padding: 0;
}

.navbar-toggler:focus {
    box-shadow: none;
}
/* END DEPRECATED NAVBAR STYLES */

/* Badges */
/* Commenting out the problematic .badge.bg-light to avoid conflicts with the more specific .hero-section .badge styling */
/*
.badge.bg-light {
    background-color: var(--popular-tag-bg);
    color: var(--popular-tag-text);
    border: 1px solid var(--border-color);
}

.badge.bg-light:hover {
    background-color: var(--popular-tag-hover-bg);
    color: var(--popular-tag-hover-text);
}
*/

/* KEEP - Still used for ratings badges */
.badge.bg-warning {
    background-color: var(--warning-color);
    color: var(--dark-color);
}

/* =============================================================================
   KEEP - Book Details Page (not yet migrated to Tailwind)
   These styles are still active for book.html
   ============================================================================= */
.book-cover-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
    width: 100%;
}

.book-cover-section {
    background-color: #f8f9fa;
    border-radius: 0.375rem 0 0 0.375rem;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    height: 100%;
}

.book-cover-section img.book-cover {
    max-height: 500px;
    max-width: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    border-radius: 5px;
}

.metadata-item {
    margin-bottom: 0.5rem;
}

.metadata-label {
    font-size: 0.875rem;
    color: var(--gray-500);
    margin-bottom: 0.25rem;
}

.metadata-value {
    font-weight: 600;
}

.description-text {
    line-height: 1.7;
}
/* END Book Details Page */

/* =============================================================================
   PARTIALLY DEPRECATED - Button Styles
   Some buttons still use Bootstrap classes (book details page)
   ============================================================================= */
.btn {
    border-radius: 8px;
    font-weight: 600;
    padding: 0.65rem 1.25rem;
    transition: all 0.2s ease-in-out;
    text-transform: none;
    letter-spacing: 0.02em;
}

.btn-primary {
    background-color: var(--button-primary-bg);
    border-color: var(--button-primary-bg);
    color: var(--button-primary-text);
}

.btn-primary:hover, .btn-primary:focus {
    background-color: var(--button-primary-hover-bg);
    border-color: var(--button-primary-hover-bg);
    color: var(--button-primary-text);
    box-shadow: 0 0 0 0.2rem var(--brand-primary-glow-color);
}

.btn-success {
    background-color: var(--success-color);
    border-color: var(--success-color);
}

.btn-outline-primary {
    color: var(--button-outline-primary-text);
    border-color: var(--button-outline-primary-border);
    background-color: transparent;
}

.btn-outline-primary:hover {
    color: var(--button-outline-primary-hover-text);
    background-color: var(--button-outline-primary-hover-bg);
    border-color: var(--button-outline-primary-border);
}

.btn-sm {
    padding: 0.25rem 1rem;
    font-size: 0.875rem;
}
/* END Button Styles */

/* =============================================================================
   KEEP - Search Results Page (not yet migrated)
   ============================================================================= */
.search-header {
    background-color: #FFFFFF;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.list-view .book-cover {
    max-height: 200px;
    object-fit: cover;
}
/* END Search Results */

/* =============================================================================
   KEEP - Pagination (not yet migrated)
   ============================================================================= */
.pagination {
    display: inline-flex;
    background: rgba(255, 255, 255, 0.1);
    padding: 0.5rem;
    border-radius: 2rem;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.pagination .page-item .page-link {
    color: var(--dark-color);
    background-color: transparent;
    border: none;
    width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    border-radius: 50%;
    margin: 0 0.25rem;
    padding: 0;
    transition: all 0.2s ease;
}

.pagination .page-item .page-link:hover {
    background-color: rgba(212, 165, 116, 0.1); /* Canvas-400 */
}

.pagination .page-item.active .page-link {
    background-color: var(--primary-color);
    color: white;
    border: none;
    box-shadow: 0 4px 6px rgba(212, 165, 116, 0.25); /* Canvas-400 */
}

.pagination .page-item .page-link:focus {
    box-shadow: none;
    outline: none;
}

.pagination .page-item.disabled .page-link {
    color: var(--gray-400);
    pointer-events: none;
}
/* END Pagination */

/* =============================================================================
   KEEP - Utility Classes (still used across app)
   ============================================================================= */
.text-primary {
    color: var(--primary-color);
}

.bg-primary {
    background-color: var(--primary-color);
}

/* Loading Indicators */
.spinner-border.text-primary {
    color: var(--primary-color);
}
/* END Utility Classes */

/* =============================================================================
   KEEP - Media Queries (still functional)
   ============================================================================= */
@media (max-width: 767.98px) {
    /* Hide search text on mobile, show only icon */
    .search-form .btn .search-text {
        display: none;
    }

    /* Adjust padding for search button on mobile */
    .search-form .btn {
        padding: 0 1rem;
    }

    /* Remove margin after icon when text is hidden */
    .search-form .btn .fa-search {
        margin-right: 0;
    }
    .book-cover-section {
        border-radius: 0.375rem 0.375rem 0 0;
        padding: 1.5rem;
    }

    .book-cover {
        max-height: 350px;
    }

    .hero-section {
        padding: 3rem 0;
    }
}

@media (min-width: 576px) and (max-width: 991.98px) {
    .col-sm-6.col-md-4.col-lg-3 {
        width: 50%;
    }
}
/* END Media Queries */

/* =============================================================================
   KEEP - Dark Theme Base
   ============================================================================= */
/* Dark Theme Overrides */
/* Variable definitions for dark theme are now centralized in variables.css */

/* body styles for dark theme are handled by general body rule + variables.css */

/* .navbar, .footer, .nav-link, .navbar-brand, .card, .card-title, .card-footer styles for dark theme
   are handled by general rules + variables.css.
   Specific overrides for .navbar-brand and .nav-link:hover/.active are below if needed. */

/* .search-form .form-control, .search-form .btn, .badge.bg-light,
   .hero-section h1, .hero-section p, h2, h3 dark theme styles
   are handled by general rules + variables.css.
   The .hero-section itself might need a specific text color if --text-color-on-accent isn't sufficient.
   The current rule for [data-theme="dark"] .hero-section { color: #E0E7FF; } is a specific override. */

[data-theme="dark"] .hero-section {
    /* Transparent so modern-hero gradient (via variables) shows, for seamless dark blending */
    background: transparent;
    border-radius: 0;
    margin-bottom: 0;
}

/* Dark Mode Styles */
[data-theme="dark"] {
    color-scheme: dark;
    /* Variable definitions for dark theme are now centralized in variables.css */
}

/* Dark mode styling for book cards and containers */
/* All styles use CSS variables - no !important declarations */

/* Text visibility in card headings and small text for dark mode */
[data-theme="dark"] .metadata-item .metadata-label,
[data-theme="dark"] .card-subtitle.text-muted,
[data-theme="dark"] .tab-content .text-muted,
[data-theme="dark"] .card .text-muted {
    color: var(--text-color-secondary);
}

/* Specific overrides for elements if needed, beyond what variables provide */
[data-theme="dark"] .other-editions-section .card-title {
    color: var(--text-color-primary);
}

[data-theme="dark"] .other-editions-section .list-unstyled {
    color: var(--text-color-secondary);
}

[data-theme="dark"] .btn-success {
    background-color: var(--success-color);
    color: white;
    border-color: var(--success-color);
}

[data-theme="dark"] .list-unstyled strong {
    color: var(--text-color-primary);
}

/* =============================================================================
   COMPONENT-SPECIFIC DARK MODE RULES
   Rules for cards and search headers in dark mode
   ============================================================================= */
@layer components {
    /* Card components with explicit light backgrounds need dark mode override */
    [data-theme="dark"] .card-footer.bg-white,
    [data-theme="dark"] .card .bg-white,
    [data-theme="dark"] .search-header {
        background-color: var(--card-bg);
    }
}

/* =============================================================================
   THEME OVERRIDES - Highest Priority Without !important
   These rules override Tailwind and component styles for theme switching
   ============================================================================= */
@layer theme-overrides {
    /* HTML and Body - Light mode defaults (ensure no white gaps) */
    html {
        background-color: #FAF8F5; /* linen-50 light mode */
    }
    
    /* Body and main content - Light mode defaults */
    .theme-body,
    body,
    main,
    .main-content {
        background-color: #FAF8F5; /* linen-50 light mode */
    }
    
    main,
    .main-content {
        padding-top: 2rem; /* Add space between navbar and content */
    }
    
    .theme-footer {
        background-color: #FFFFFF; /* white light mode */
    }
    
    /* HTML and Body - Dark mode (ensure no white gaps) */
    [data-theme="dark"] html {
        background-color: #0F1419; /* slate-900 - page background color */
    }
    
    /* Body and main content dark mode - slate-900 page background, slate-50 text */
    [data-theme="dark"] body,
    [data-theme="dark"] .theme-body,
    [data-theme="dark"] main,
    [data-theme="dark"] .main-content {
        background-color: #0F1419; /* slate-900 - page background color */
        color: #F8FAFC; /* slate-50 */
    }
    
    [data-theme="dark"] main,
    [data-theme="dark"] .main-content {
        padding-top: 2rem; /* Add space between navbar and content */
    }
    
    /* Footer dark mode - slate-800 to match navbar elevation */
    [data-theme="dark"] footer,
    [data-theme="dark"] .theme-footer {
        background-color: #1E293B; /* slate-800 */
        border-color: #334155; /* slate-700 */
    }
    
    /* Navbar border colors - Light mode default and dark mode override */
    .theme-navbar-border {
        border-color: rgba(230, 220, 200, 0.6); /* anthracite-200 with opacity for light mode */
    }
    
    [data-theme="dark"] .theme-navbar-border {
        border-color: transparent; /* No visible border in dark mode */
    }
    
    /* Footer border colors - Light mode default and dark mode override */
    .theme-footer-border {
        border-color: #EDE6D9; /* linen-300 for light mode */
    }
    
    [data-theme="dark"] .theme-footer-border {
        border-color: #334155; /* slate-700 for dark mode */
    }
    
    /* Footer text colors in dark mode */
    [data-theme="dark"] .theme-footer-text {
        color: #94A3B8; /* slate-400 */
    }
    
    [data-theme="dark"] .theme-footer-link {
        color: #60A5FA; /* canvas-500 equivalent for dark mode */
    }
    
    [data-theme="dark"] .theme-footer-link:hover {
        color: #93C5FD; /* canvas-400 equivalent for dark mode */
    }
    
    /* Hero Section */
    [data-theme="dark"] .theme-hero-bg {
        background-color: #0F1419; /* slate-900 */
    }
    
    [data-theme="dark"] .theme-hero-title {
        color: #F8FAFC; /* slate-50 */
    }
    
    [data-theme="dark"] .theme-hero-text {
        color: #94A3B8; /* slate-400 */
    }
    
    /* Search Input */
    [data-theme="dark"] .theme-search-input {
        background-color: #1E293B; /* slate-800 */
        color: #F8FAFC; /* slate-50 */
        border-color: #334155; /* slate-700 */
    }
    
    [data-theme="dark"] .theme-search-button {
        background-color: #3B82F6; /* canvas-600 */
        color: #0F1419; /* slate-900 */
    }
    
    [data-theme="dark"] .theme-search-button:hover {
        background-color: #2563EB; /* canvas-700 */
    }
    
    /* Tags/Badges */
    [data-theme="dark"] .theme-tag {
        background-color: #1E293B; /* slate-800 */
        color: #CBD5E1; /* slate-200 */
        border-color: #334155; /* slate-700 */
    }
    
    [data-theme="dark"] .theme-tag:hover {
        background-color: #334155; /* slate-700 */
        border-color: #3B82F6; /* canvas-600 */
        color: #60A5FA; /* canvas-400 */
    }
    
    [data-theme="dark"] .theme-badge {
        background-color: #334155; /* slate-700 */
        color: #CBD5E1; /* slate-300 */
    }
    
    /* Section Backgrounds - Light mode defaults and dark mode overrides */
    .theme-hero-bg,
    .theme-section-alt {
        background-color: #FAF8F5; /* linen-100 light mode */
    }
    
    .theme-section {
        background-color: #FFFFFF; /* white light mode */
    }
    
    /* Dark mode: Unified dark background for all sections (like book detail page) */
    [data-theme="dark"] .theme-section-alt,
    [data-theme="dark"] .theme-hero-bg,
    [data-theme="dark"] .theme-section,
    [data-theme="dark"] section.theme-hero-bg,
    [data-theme="dark"] section.theme-section,
    [data-theme="dark"] section.theme-section-alt,
    [data-theme="dark"] section.bg-linen-50,
    [data-theme="dark"] section.bg-linen-100,
    [data-theme="dark"] section.bg-white,
    [data-theme="dark"] .py-12.theme-section,
    [data-theme="dark"] .py-16.theme-section {
        background-color: #0F1419; /* slate-900 - unified page background */
    }
    
    /* Card Components - Light mode defaults and dark mode overrides */
    .theme-card {
        background-color: #FFFFFF; /* white light mode */
    }
    
    .theme-card-cover-bg {
        background-color: #FAF8F5; /* linen-100 light mode */
    }
    
    .theme-badge {
        background-color: #EDE6D9; /* linen-200 light mode */
    }
    
    [data-theme="dark"] .theme-card {
        background-color: #293548; /* Slightly lighter than slate-800 for contrast */
        border-color: #334155; /* slate-700 */
    }
    
    [data-theme="dark"] .theme-card-cover-bg {
        background-color: #1E293B; /* slate-800 - slightly lighter than before */
    }
    
    [data-theme="dark"] .theme-card-title {
        color: #F8FAFC; /* slate-50 */
    }
    
    [data-theme="dark"] .theme-card-title:hover {
        color: #60A5FA; /* canvas-400 */
    }
    
    [data-theme="dark"] .theme-card-text {
        color: #94A3B8; /* slate-400 */
    }
    
    [data-theme="dark"] .theme-card-meta {
        color: #64748B; /* slate-500 */
    }
    
    [data-theme="dark"] .theme-card-button {
        background-color: #3B82F6; /* canvas-600 */
        color: #0F1419; /* slate-900 */
    }
    
    [data-theme="dark"] .theme-card-button:hover {
        background-color: #2563EB; /* canvas-700 */
    }
    
    /* Section Titles and Links */
    [data-theme="dark"] .theme-section-title {
        color: #F8FAFC; /* slate-50 */
    }
    
    [data-theme="dark"] .theme-section-link {
        color: #60A5FA; /* canvas-500 */
        border-color: #3B82F6; /* canvas-600 */
    }
    
    [data-theme="dark"] .theme-section-link:hover {
        background-color: #334155; /* slate-700 */
        color: #60A5FA; /* canvas-400 */
    }
    
    /* Search Header - Light mode default and dark mode override */
    .theme-search-header {
        background-color: #FFFFFF; /* white light mode */
    }
    
    [data-theme="dark"] .theme-search-header {
        background-color: #1E293B; /* slate-800 - elevated card surface */
        border-color: #334155; /* slate-700 */
    }
}

[data-theme="dark"] .text-decoration-none.text-dark,
[data-theme="dark"] .card-title a {
    color: var(--text-color-primary);
}

/* Form controls, dropdowns, and pagination should now be styled by their general rules using dark theme variables.
   Only keep specific [data-theme="dark"] rules if a distinct appearance is required beyond variable changes. */

/* Example: If pagination needs a very specific dark mode look not achievable with variables alone */
/* [data-theme="dark"] .pagination { ... } */


/* =============================================================================
   KEEP - Theme Toggle Button (still functional)
   ============================================================================= */
#theme-toggle {
    border-radius: 50%;
    width: 38px;
    height: 38px;
    padding: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
    transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out, color 0.2s ease-in-out;
}

#theme-toggle i {
    font-size: 1rem;
}

/* Light Mode Hover Effect */
#theme-toggle:hover {
    background-color: var(--gray-200);
    box-shadow: 0 0 8px rgba(0,0,0,0.15);
    color: var(--primary-dark);
}

/* Dark Mode Hover Effect */
[data-theme="dark"] #theme-toggle:hover {
    background-color: var(--gray-100);
    box-shadow: 0 0 10px var(--primary-glow-color);
    color: var(--primary-color);
}

/* Make the theme toggle more visible on mobile in dark mode */
[data-theme="dark"] #theme-toggle {
    color: white; /* Light color for visibility */
    background-color: rgba(255, 255, 255, 0.15); /* Subtle light background */
    box-shadow: 0 0 5px rgba(255, 255, 255, 0.2); /* Subtle glow */
}

/* Ensure the theme toggle is large enough and has proper spacing on mobile */
.theme-toggle-header.d-lg-none {
    margin-right: 10px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
}
/* END Theme Toggle */

/* =============================================================================
   KEEP - Book Details Dark Mode Styles (not yet migrated)
   ============================================================================= */
/* Dark mode styling for "Other Editions" section in book details */
[data-theme="dark"] #bookDetailTabContent #editions .list-group {
    background-color: transparent;
    border: none;
}

[data-theme="dark"] #bookDetailTabContent #editions .list-group-item {
    background-color: var(--card-bg);
    color: var(--text-color-primary);
    border-color: var(--border-color);
}

[data-theme="dark"] #bookDetailTabContent #editions .list-group-item.active {
    background-color: var(--brand-primary);
    color: var(--text-on-primary-bg);
    border-color: var(--brand-primary);
}

[data-theme="dark"] #bookDetailTabContent #editions .other-editions-section h3 {
    color: var(--text-color-primary);
}

[data-theme="dark"] #bookDetailTabContent #editions p,
[data-theme="dark"] #bookDetailTabContent #editions .metadata-label,
[data-theme="dark"] #bookDetailTabContent #editions small {
    color: var(--text-color-secondary);
}

/* Book Details Dark Mode - Maintained for book.html */

/* =============================================================================
   KEEP - Development Mode Indicators
   ============================================================================= */
.dev-source-indicator {
    opacity: 0.9;
    border-radius: 50%;
    color: white;
    line-height: 0;
}

.dev-source-GOOGLE_BOOKS { background-color: var(--danger-color); }
.dev-source-OPEN_LIBRARY { background-color: var(--info-color); }
.dev-source-LONGITOOD { background-color: var(--secondary-color); }
.dev-source-S3_CACHE { background-color: var(--success-color); }
.dev-source-LOCAL_CACHE { background-color: var(--warning-color); color: var(--dark-color); text-shadow: none;}
.dev-source-UNDEFINED { background-color: var(--gray-500); }
.dev-source-ANY { background-color: var(--gray-400); }
.dev-source-NONE { background-color: var(--gray-300); color: var(--dark-color); text-shadow: none;}
/* END Development Indicators */

/* =============================================================================
   KEEP - Normalized Book Covers (still functional)
   ============================================================================= */
.normalized-cover {
    height: auto;
    width: auto;
    max-height: 85%;
    max-width: 85%;
    object-fit: contain;
    transform: none;
    margin: auto;
    padding: 5px;
}

/* Specific grid view settings */
.book-cover-container .normalized-cover {
    max-height: 80%;
    max-width: 80%;
}

/* Specific list view settings */
.book-cover-wrapper .normalized-cover {
    max-height: 180px;
    object-fit: contain;
}

/* Special handling for high-resolution images */
.high-res-cover {
    transform: scale(0.88);
    max-height: 85%;
}

[data-theme="dark"] .book-cover-section {
    background-color: transparent;
}
/* END Normalized Covers */

/* =============================================================================
   KEEP - Tab Styling (not yet migrated)
   ============================================================================= */
[data-theme="dark"] .nav-tabs {
    border-bottom-color: var(--border-color);
}

[data-theme="dark"] .nav-tabs .nav-link {
    color: var(--text-color-secondary);
}

[data-theme="dark"] .nav-tabs .nav-link.active {
    background-color: transparent;
    border-color: var(--border-color) var(--border-color) transparent;
    color: var(--primary-color);
}

[data-theme="dark"] .nav-tabs .nav-link:hover:not(.active) {
    border-color: var(--border-color) var(--border-color) var(--border-color);
    color: var(--text-color);
}

/* Book details headings, if general h5 and metadata-label variables are not sufficient */
[data-theme="dark"] .book-metadata .metadata-label,
[data-theme="dark"] .tab-content h5 {
    color: var(--text-color-secondary);
}
/* END Tab Styling */



/* The hero-section, search-form .btn, cards, placeholders, popular-tags
   should now mostly be styled correctly by the generic rules using dark theme variables.
   We only add specific overrides if the generic variable approach isn't sufficient
   or if a distinctly different style is wanted for dark mode beyond variable changes. */

/* Example: If badges need further specific dark mode tweaks not covered by their variables */
/* [data-theme="dark"] .badge.bg-light { ... } */

/* Ensure any text that should remain dark on a light background (or vice-versa) is handled.
   Most of these should be covered by the new text color variables. */

/* Clean up previous specific dark theme rules if they are now handled by the variables */
/* For example, if you had specific color settings for h2, h3, card-title etc. in dark mode,
   they should now inherit correctly from 'color: var(--text-color);'
   or use 'var(--text-color-secondary)' as appropriate. */

/* Remove or comment out old [data-theme="dark"] rules that are now covered by the new variable system.
   For example, lines like:
   [data-theme="dark"] body { background-color: #1F2937; color: #F9FAFB; }
   [data-theme="dark"] .card { background-color: #374151; border-color: #4B5563; }
   ...and so on, should be removed as these are handled by var(--background-color), var(--text-color), var(--card-bg) etc.
*/

/* End of file */


[data-theme="dark"] .hero-section {
    /* background: linear-gradient(135deg, var(--hero-gradient-start) 0%, var(--hero-gradient-end) 100%); /* OLD GRADIENT */
    background-color: var(--hero-bg-color); /* Solid dark background, as per inspiration */
}


/* "View All" button in dark mode - uses CSS variables */
[data-theme="dark"] .btn-view-all.btn-outlined {
    background-color: transparent;
    color: var(--link-color);
    border-color: transparent;
    padding-left: 0;
    padding-right: 0;
}

[data-theme="dark"] .btn-view-all.btn-outlined:hover {
    background-color: transparent;
    color: var(--link-hover-color);
    border-color: transparent;
    text-decoration: underline;
}

[data-theme="dark"] .search-form .form-control {
    color: var(--text-color-primary);
    background-color: var(--input-bg);
    border-color: var(--input-border-color);
}

[data-theme="dark"] .search-form .form-control::placeholder {
    color: var(--placeholder-text-color);
}

/* Dark mode card styling - uses CSS variables for consistency */
[data-theme="dark"] .card {
    background-color: var(--card-bg);
    border-color: var(--border-color);
    box-shadow: var(--card-shadow);
    transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
}

[data-theme="dark"] .card:hover {
    transform: translateY(-6px);
    box-shadow: var(--card-shadow-hover);
    border-color: var(--brand-primary);
}

/* Fix text colors using CSS variables */
[data-theme="dark"] .card .card-title,
[data-theme="dark"] .card .card-title a {
    color: var(--text-color-primary);
    font-weight: 600;
}

[data-theme="dark"] .card .card-text.small,
[data-theme="dark"] .card .card-text.small a,
[data-theme="dark"] .card .text-muted {
    color: var(--text-color-secondary);
}

/* Search results card text visibility fixes - override Bootstrap text-dark class */
[data-theme="dark"] .card .book-title,
[data-theme="dark"] .card .book-title a,
[data-theme="dark"] .card .book-title .text-dark,
[data-theme="dark"] .card-title .text-decoration-none.text-dark {
    color: var(--text-color-primary);
}

[data-theme="dark"] .card .book-author,
[data-theme="dark"] .card-text.book-author {
    color: var(--text-color-secondary);
}

[data-theme="dark"] .card .book-description {
    color: var(--text-color-secondary);
}

/* Card footer using CSS variables */
[data-theme="dark"] .card-footer {
    background-color: var(--card-bg);
    border-top-color: var(--border-color);
}

/* Button styling using CSS variables */
[data-theme="dark"] .card-footer .btn {
    background-color: var(--button-primary-bg);
    color: var(--button-primary-text);
    border-color: var(--button-primary-bg);
    font-weight: 500;
    border-radius: 4px;
    padding: 0.5rem 1rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease;
}

[data-theme="dark"] .card-footer .btn:hover {
    background-color: var(--button-primary-hover-bg);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    transform: translateY(-1px);
}

/* Card body backgrounds using CSS variables */
[data-theme="dark"] .card-body {
    background-color: var(--card-bg);
}

/* Book cover container background */
[data-theme="dark"] .book-cover-container {
    background-color: var(--card-bg);
}

/* Ratings badge with proper contrast */
[data-theme="dark"] .badge.bg-warning {
    background-color: var(--warning-color);
    color: var(--dark-color);
}


/* =============================================================================
   KEEP - Search/Book Details Dark Mode (not yet migrated)
   ============================================================================= */
/* Ensure search result text visibility in dark mode */
[data-theme="dark"] .search-results-container h2,
[data-theme="dark"] .search-results-container h3,
[data-theme="dark"] .search-results-container p {
    color: var(--text-color-primary);
}

/* Specific override for "Results for:" text */
[data-theme="dark"] .search-header {
    color: var(--text-color-primary);
}

/* Fix for "Results for" text in the search header */
[data-theme="dark"] .search-header .text-muted {
    color: var(--text-color-secondary);
}

/* Dark mode text color fixes for book details page */
[data-theme="dark"] .breadcrumb-item,
[data-theme="dark"] .breadcrumb-item a,
[data-theme="dark"] .breadcrumb-item.active {
    color: var(--text-color-secondary);
}

[data-theme="dark"] .book-details h1.card-title,
[data-theme="dark"] .book-details h5.card-subtitle,
[data-theme="dark"] .book-details .metadata-value,
[data-theme="dark"] .book-details .card-text,
[data-theme="dark"] .book-description,
[data-theme="dark"] .book-details-section h5,
[data-theme="dark"] .book-details .nav-tabs .nav-link,
[data-theme="dark"] .book-categories h5 {
    color: var(--text-color-primary);
}

[data-theme="dark"] .book-details .metadata-label,
[data-theme="dark"] .book-details .small.text-muted {
    color: var(--text-color-secondary);
}

[data-theme="dark"] .book-details .fw-bold {
    color: var(--text-color-secondary);
}

[data-theme="dark"] .nav-tabs .nav-link.active {
    color: var(--brand-primary);
    background-color: var(--gray-900);
    border-color: var(--gray-700);
    border-bottom-color: var(--gray-900);
}

/* Ensure tab content has proper backgrounds in dark mode */
[data-theme="dark"] .tab-content {
    background-color: transparent;
}

/* Tab pane text visibility in dark mode */
[data-theme="dark"] .tab-pane h5,
[data-theme="dark"] .tab-pane .card-text {
    color: var(--text-color-primary);
}

[data-theme="dark"] .tab-pane .text-muted,
[data-theme="dark"] .tab-pane p.text-muted {
    color: var(--text-color-secondary);
}

/* Categories section text visibility in dark mode */
[data-theme="dark"] .categories-section h5,
[data-theme="dark"] .categories-section .card-text {
    color: var(--text-color-primary);
}

[data-theme="dark"] .categories-section .text-muted,
[data-theme="dark"] .categories-section p.text-muted {
    color: var(--text-color-secondary);
}

/* Details section text visibility in dark mode */
[data-theme="dark"] .details-section h5,
[data-theme="dark"] .details-section .card-text,
[data-theme="dark"] .details-section .metadata-value {
    color: var(--text-color-primary);
}

[data-theme="dark"] .details-section .text-muted,
[data-theme="dark"] .details-section .metadata-label {
    color: var(--text-color-secondary);
}

/* Other editions section text visibility in dark mode */
[data-theme="dark"] .other-editions-section h5,
[data-theme="dark"] .other-editions-section .list-group-item-heading {
    color: var(--text-color-primary);
}

[data-theme="dark"] .other-editions-section .text-muted,
[data-theme="dark"] .other-editions-section .list-group-item-text {
    color: var(--text-color-secondary);
}

/* Ensure breadcrumb links have proper styling */
[data-theme="dark"] .breadcrumb-item a:hover {
    color: var(--link-hover-color);
}
/* END Search/Book Details Dark Mode */

/* =============================================================================
   KEEP - Mobile Responsive (still functional)
   ============================================================================= */
/* Mobile responsive active link styling */
@media (max-width: 991.98px) {
    .nav-link.active:after,
    [data-theme="light"] .modern-navbar .nav-link.active:after {
        bottom: 0;
        height: 2px;
        width: auto;
        left: 0;
        right: 0;
        display: inline-block;
    }

    .navbar-collapse .nav-link {
        padding: 0.75rem 1rem;
        display: inline-block;
    }

    /* Use flexbox to align child elements (e.g., links) within navigation items for mobile responsiveness */
    .nav-item {
        display: flex;
    }
}
/* END Mobile Responsive */

/* =============================================================================
   KEEP - Affiliate Buttons (still functional)
   ============================================================================= */
/* Custom Affiliate Button Styles */
.btn.btn-affiliate {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
    margin-bottom: 0.5rem;
}
.btn.btn-affiliate:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

/* Uniform height & centering for affiliate buttons & dropdown */
.btn-affiliate {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 2.5rem;
    padding: 0 1.25rem;
}

.btn.btn-barnesandnoble {
    background-color: #00563f;
    border-color: #00563f;
    color: #ffffff;
}
.btn.btn-barnesandnoble:hover {
    background-color: #00402f;
    border-color: #003526;
}

.btn.btn-bookshop {
    background-color: #4C32C0;
    border-color: #4C32C0;
    color: #ffffff;
}
.btn.btn-bookshop:hover {
    background-color: #3c28a0;
    border-color: #302080;
}

.btn.btn-audible {
    background-color: #ff9900;
    border-color: #ff9900;
    color: #000000;
}
.btn.btn-audible:hover {
    background-color: #e68a00;
    border-color: #cc7a00;
    color: #000000;
}
/* End Custom Affiliate Button Styles */

/* Affiliate Dropdown Styles */
.affiliate-dropdown .dropdown-toggle {
    display: flex;
    align-items: center;
}
.affiliate-dropdown .dropdown-toggle::after {
    margin-left: .5rem;
}
.affiliate-dropdown .dropdown-menu {
    background-color: #fff;
    border: 1px solid rgba(0,0,0,0.1);
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    border-radius: .5rem;
    transition: none;
    transform: none;
    margin-top: .25rem;
    -webkit-backdrop-filter: blur(8px);
    backdrop-filter: blur(8px);
}
.affiliate-dropdown .dropdown-item {
    padding: .5rem 1rem;
    transition: background-color 0.2s ease, color 0.2s ease;
}
.affiliate-dropdown .dropdown-item:hover {
    background-color: #f8f9fa;
}
/* Dark mode overrides for affiliate dropdown */
[data-theme="dark"] .affiliate-dropdown .dropdown-menu {
    background-color: #2d2d2d;
    border-color: rgba(255,255,255,0.1);
}
[data-theme="dark"] .affiliate-dropdown .dropdown-item:hover {
    background-color: rgba(255,255,255,0.1);
}

/* Improved Affiliate Dropdown Positioning and Width */
.affiliate-dropdown {
    position: relative;
    display: inline-block;
    overflow: visible;
}
.affiliate-dropdown .dropdown-menu {
    min-width: 200px;
    width: auto;
    max-width: 300px;
    left: 0;
    right: auto;
    z-index: 1050;
    -webkit-backdrop-filter: blur(8px);
    backdrop-filter: blur(8px);
    background-color: rgba(255,255,255,0.85);
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: .5rem;
    white-space: nowrap;
}

/* Responsive sizing for dropdown on mobile */
@media (max-width: 767.98px) {
    .affiliate-dropdown .dropdown-menu {
        min-width: 180px;
        max-width: calc(100vw - 2rem);
    }
}

/* Dark mode reinterpretation */
[data-theme="dark"] .affiliate-dropdown .dropdown-menu {
    background-color: rgba(20,20,30,0.85);
    border-color: rgba(255,255,255,0.1);
}

/* Consistent colors for dropdown items */
.affiliate-dropdown .dropdown-item {
    color: var(--text-color-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.affiliate-dropdown .dropdown-item:hover,
.affiliate-dropdown .dropdown-item:focus {
    background-color: #D4A574; /* Canvas-400 */
    color: #ffffff;
}
.affiliate-dropdown .dropdown-item.active {
    background-color: #D4A574;
    color: #ffffff;
}

/* Allow affiliate dropdown menu to overflow main book card */
.book-details > .card.shadow.border-0.mb-5 {
    overflow: visible;
}

/* Ensure tab content allows dropdown overflow */
.tab-content {
    overflow: visible;
}
/* END Affiliate Buttons & Dropdowns */

/* =============================================================================
   KEEP - Bootstrap Alert Dark Mode Overrides
   Bootstrap alerts need explicit dark mode styling to prevent light mode fallback
   ============================================================================= */
[data-theme="dark"] .alert {
    color: var(--text-color-primary);
    background-color: var(--card-bg);
    border-color: var(--border-color);
}

[data-theme="dark"] .alert-warning {
    background-color: rgba(251, 191, 36, 0.15); /* warning-color with low opacity */
    border-color: rgba(251, 191, 36, 0.3);
    color: #FCD34D; /* Brighter yellow for visibility on dark bg */
}

[data-theme="dark"] .alert-danger {
    background-color: rgba(239, 68, 68, 0.15); /* danger-color with low opacity */
    border-color: rgba(239, 68, 68, 0.3);
    color: #FCA5A5; /* Brighter red for visibility on dark bg */
}

[data-theme="dark"] .alert-info {
    background-color: rgba(59, 130, 246, 0.15); /* info-color with low opacity */
    border-color: rgba(59, 130, 246, 0.3);
    color: #93C5FD; /* Brighter blue for visibility on dark bg */
}

[data-theme="dark"] .alert-success {
    background-color: rgba(16, 185, 129, 0.15); /* success-color with low opacity */
    border-color: rgba(16, 185, 129, 0.3);
    color: #6EE7B7; /* Brighter green for visibility on dark bg */
}

/* Icons inside alerts should maintain proper contrast */
[data-theme="dark"] .alert i.fas,
[data-theme="dark"] .alert i.fa {
    opacity: 0.9;
}

[data-theme="dark"] .alert-secondary {
    background-color: rgba(100, 116, 139, 0.15); /* slate-500 with low opacity */
    border-color: rgba(100, 116, 139, 0.3);
    color: #94A3B8; /* slate-400 for visibility */
}
/* END Bootstrap Alert Dark Mode */

/* =============================================================================
   KEEP - Bootstrap Badge Dark Mode Overrides
   Badges need explicit dark mode styling to prevent light mode fallback
   ============================================================================= */
[data-theme="dark"] .badge {
    color: var(--text-color-primary);
}

[data-theme="dark"] .badge.bg-primary {
    background-color: var(--brand-primary);
    color: var(--text-on-primary-bg);
}

[data-theme="dark"] .badge.bg-light {
    background-color: rgba(148, 163, 184, 0.2); /* slate-400 with opacity */
    color: #CBD5E1; /* slate-300 */
    border-color: rgba(148, 163, 184, 0.3);
}

[data-theme="dark"] .badge.bg-info {
    background-color: rgba(59, 130, 246, 0.2); /* info-color with opacity */
    color: #93C5FD; /* Brighter blue for visibility */
    border-color: rgba(59, 130, 246, 0.3);
}

[data-theme="dark"] .badge.bg-secondary {
    background-color: rgba(100, 116, 139, 0.2); /* slate-500 */
    color: #94A3B8; /* slate-400 */
}

[data-theme="dark"] .badge.text-dark {
    color: #F8FAFC; /* Override Bootstrap's text-dark in dark mode */
}
/* END Bootstrap Badge Dark Mode */

/* =============================================================================
   KEEP - Bootstrap Breadcrumb Dark Mode Overrides
   Breadcrumbs need proper dark mode styling for navigation clarity
   ============================================================================= */
[data-theme="dark"] .breadcrumb {
    background-color: transparent;
}

[data-theme="dark"] .breadcrumb-item,
[data-theme="dark"] .breadcrumb-item a {
    color: var(--text-color-secondary);
}

[data-theme="dark"] .breadcrumb-item.active {
    color: var(--text-color-primary);
}

[data-theme="dark"] .breadcrumb-item + .breadcrumb-item::before {
    color: var(--text-color-secondary);
}

[data-theme="dark"] .breadcrumb-item a:hover {
    color: var(--link-hover-color);
}
/* END Bootstrap Breadcrumb Dark Mode */

/* =============================================================================
   KEEP - Bootstrap Button Dark Mode Overrides (Additional Coverage)
   Ensure all button variants have proper dark mode styling
   ============================================================================= */
[data-theme="dark"] .btn-secondary {
    background-color: #475569; /* slate-600 */
    border-color: #475569;
    color: #F8FAFC;
}

[data-theme="dark"] .btn-secondary:hover {
    background-color: #334155; /* slate-700 */
    border-color: #334155;
}

[data-theme="dark"] .btn-outline-secondary {
    color: #94A3B8; /* slate-400 */
    border-color: #475569; /* slate-600 */
}

[data-theme="dark"] .btn-outline-secondary:hover {
    background-color: rgba(71, 85, 105, 0.2);
    color: #CBD5E1; /* slate-300 */
    border-color: #64748B; /* slate-500 */
}

[data-theme="dark"] .btn-info {
    background-color: var(--info-color);
    border-color: var(--info-color);
    color: #FFFFFF;
}

[data-theme="dark"] .btn-info:hover {
    background-color: var(--brand-secondary-dark);
    border-color: var(--brand-secondary-dark);
}
/* END Bootstrap Button Dark Mode */

/* =============================================================================
   KEEP - Bootstrap Form Control Dark Mode Overrides
   Form inputs need proper dark mode styling to prevent light mode fallback
   ============================================================================= */
[data-theme="dark"] .form-control,
[data-theme="dark"] .form-select {
    background-color: var(--input-bg);
    border-color: var(--input-border-color);
    color: var(--text-color-primary);
}

[data-theme="dark"] .form-control:focus,
[data-theme="dark"] .form-select:focus {
    background-color: var(--input-bg);
    border-color: var(--input-focus-border-color);
    color: var(--text-color-primary);
    box-shadow: var(--input-focus-shadow);
}

[data-theme="dark"] .form-control::placeholder {
    color: var(--placeholder-text-color);
}

[data-theme="dark"] .form-control:disabled,
[data-theme="dark"] .form-select:disabled {
    background-color: rgba(51, 65, 85, 0.3); /* slate-700 with opacity */
    color: var(--text-color-secondary);
}

/* Input Group styling */
[data-theme="dark"] .input-group-text {
    background-color: #334155; /* slate-700 */
    border-color: var(--input-border-color);
    color: var(--text-color-secondary);
}

/* Form labels */
[data-theme="dark"] .form-label {
    color: var(--text-color-primary);
}

/* Form text (help text) */
[data-theme="dark"] .form-text {
    color: var(--text-color-secondary);
}
/* END Bootstrap Form Control Dark Mode */

/* =============================================================================
   KEEP - Bootstrap Dropdown Dark Mode Overrides
   Dropdowns need proper dark mode styling (beyond affiliate dropdown)
   ============================================================================= */
[data-theme="dark"] .dropdown-menu {
    background-color: var(--dropdown-bg);
    border-color: var(--dropdown-border-color);
}

[data-theme="dark"] .dropdown-item {
    color: var(--text-color-primary);
}

[data-theme="dark"] .dropdown-item:hover,
[data-theme="dark"] .dropdown-item:focus {
    background-color: var(--dropdown-item-hover-bg);
    color: var(--dropdown-item-hover-text);
}

[data-theme="dark"] .dropdown-item.active,
[data-theme="dark"] .dropdown-item:active {
    background-color: var(--dropdown-item-active-bg);
    color: var(--dropdown-item-active-text);
}

[data-theme="dark"] .dropdown-divider {
    border-top-color: var(--border-color);
}

[data-theme="dark"] .dropdown-header {
    color: var(--text-color-secondary);
}
/* END Bootstrap Dropdown Dark Mode */

/* =============================================================================
   KEEP - Container and Layout Dark Mode Coverage
   Ensure all container elements inherit dark background properly
   ============================================================================= */
[data-theme="dark"] .container,
[data-theme="dark"] .container-fluid,
[data-theme="dark"] div.container,
[data-theme="dark"] div.container-fluid {
    background-color: transparent; /* Force transparent to let parent background show through */
}

/* Ensure the main page container areas don't have white backgrounds */
[data-theme="dark"] main .container,
[data-theme="dark"] .main-content .container,
[data-theme="dark"] main div.container,
[data-theme="dark"] .main-content div.container {
    background-color: transparent;
}

/* Target Bootstrap padding utility classes that might have backgrounds */
[data-theme="dark"] .py-1,
[data-theme="dark"] .py-2,
[data-theme="dark"] .py-3,
[data-theme="dark"] .py-4,
[data-theme="dark"] .py-5 {
    background-color: transparent;
}

/* Ensure Bootstrap grid system elements are transparent */
[data-theme="dark"] .row,
[data-theme="dark"] .col,
[data-theme="dark"] [class*="col-"] {
    background-color: transparent;
}

/* Ensure all direct children of main content areas are transparent */
[data-theme="dark"] main > *,
[data-theme="dark"] .main-content > *,
[data-theme="dark"] main > div,
[data-theme="dark"] .main-content > div {
    background-color: transparent;
}

/* Nuclear option: Force all divs within main to be transparent unless they're cards/alerts */
[data-theme="dark"] main div:not(.card):not(.alert):not(.badge):not(.btn),
[data-theme="dark"] .main-content div:not(.card):not(.alert):not(.badge):not(.btn) {
    background-color: transparent;
}
/* END Container Dark Mode */
